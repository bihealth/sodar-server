{% load samplesheets_tags %}

{# Projectroles dependency #}
{% load projectroles_common_tags %}

{# Load irodsbackend tags if backend is active #}
{% if irods_backend %}
  {% load irodsbackend_tags %}
{% endif %}

{% get_class parent lower=True as parent_class %}

<table class="table cell-border order-column omics-ss-data-table omics-ss-data-table-{{ parent_class }}" id="{% get_table_id parent %}">
  <thead>
    {# Top header #}
    <tr>
      {% autoescape off %}
        {% render_top_headers table.top_header table.col_values %}
      {% endautoescape %}
      {% if parent_class == 'assay' %}
        <th class="bg-white omics-ss-top-header omics-ss-data-links-header omics-ss-data-cell-links">&nbsp;</th>
      {% endif %}
    </tr>
    {# Field header #}
    <tr class="omics-ss-header-row">
      {% autoescape off %}
        {% render_field_headers table.field_header table.col_values %}
      {% endautoescape %}
      {% if parent_class == 'assay' %}
        <th class="bg-white omics-ss-data-links-header">Links</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {# Content #}
    {% for row in table.table_data %}
      {% get_row_id as row_id %}
      <tr id="omics-ss-data-row-{{ row_id }}">
        {% autoescape off %}
          {% render_cells row table.col_values %}
        {% endautoescape %}
        {% if parent_class == 'assay' %}
          <td class="bg-light omics-ss-data-cell-links">
            {# TODO: Refactor this #}
            {% if irods_backend %}
              {% get_irods_row_path parent table row as irods_path %}
              <button class="btn btn-secondary omics-list-btn omics-ss-popup-list-btn"
                      list-url="{% url 'samplesheets:irods_list' assay=parent.omics_uuid %}"
                      irods-path="{{ irods_path }}"
                      role="submit" title="List files"
                      {% if not investigation.irods_status %} disabled{% endif %}>
                <i class="fa fa-external-link"></i>
              </button>
            {% endif %}
            <button class="btn btn-secondary omics-list-btn omics-ss-popup-cmd-btn"
                    {# TODO: Add row-specific parameters #}
                    irods-path="{{ irods_path }}"
                    role="submit" title="Get iCommands path to files"
                    {% if not investigation.irods_status %} disabled{% endif %}>
              <i class="fa fa-terminal"></i>
             </button>
             <a class="btn btn-secondary omics-list-btn omics-ss-dav-btn mr-1
                {% if not irods_webdav_enabled or not investigation.irods_status %} disabled{% endif %}"
                href="{{ irods_webdav_url }}{{ irods_path }}" role="button"
                title="Browse files in WebDAV">
              <i class="fa fa-folder-open-o"></i>
            </a>
          </td>
        {% endif %}
      </tr>
    {% endfor %}
   </tbody>
</table>
