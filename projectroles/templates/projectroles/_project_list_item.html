{% load rules %}
{% load projectroles_tags %}

{% has_perm 'projectroles.view_project' request.user p as can_view_project %}
{% has_perm 'timeline.view_timeline' request.user p as can_view_timeline %}

{% if not is_child or can_view_project %}
  <tr>
    {% if not p.parent or no_indent %}
      <td style="white-space: nowrap;">
    {% else %}
      <td style="white-space: nowrap; padding-left: 40px;">
    {% endif %}
      {% if p.type == 'CATEGORY' %}
        <i class="fa fa-cubes" aria-hidden="true"></i>
      {% else %}
        <i class="fa fa-cube" aria-hidden="true"></i>
      {% endif %}
      {% if can_view_project %}
        <a href="{% url 'project_detail' pk=p.pk %}">{{ p.title }}</a>
      {% else %}
        <span class="text-muted">{{ p.title }}</span>
      {% endif %}
    </td>
    <td>
      {% get_description p %}
    </td>
    <td>
      {% if request.user.is_superuser %}
        <span class="text-danger">superuser</span>
      {% else %}
        {% get_user_role_str p request.user %}
      {% endif %}
    </td>
    {% comment %}
    {% if can_view_project and can_view_timeline %}
      {% autoescape off %}
        {% get_latest_activity p timeline_backend %}
      {% endautoescape %}
    {% else %}
      <td colspan="3"></td>
    {% endif %}
    {% endcomment %}
  </tr>
{% endif %}
